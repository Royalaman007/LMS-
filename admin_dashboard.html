<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexora - Admin Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .top-header {
            background: #fff;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }
        .logo-section {
            display: flex;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            justify-content: center;
        }
        .logo-section img {
            height: 60px;
            margin-right: 15px;
        }
        .logo-section h1 {
            color: #1a237e;
            margin: 0;
            font-size: 28px;
            font-weight: 600;
        }
        .nav-bar {
            background: #1a237e;
            padding: 0;
            margin: 0;
        }
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-links {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
        }
        .nav-links li {
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 15px 20px;
            display: block;
            transition: background-color 0.3s;
        }
        .nav-links a:hover, .nav-links a.active {
            background-color: #283593;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        .content-section {
            background: white;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            padding: 20px;
        }
        .section-header {
            border-bottom: 2px solid #1a237e;
            padding-bottom: 10px;
            margin-bottom: 20px;
            color: #1a237e;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }
        .form-group select, .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        .btn-primary {
            background-color: #1a237e;
            color: white;
        }
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        .btn:hover {
            opacity: 0.9;
        }
        .members-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .member-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
        }
        .main-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .card h2 {
            color: #333;
            margin-top: 0;
        }
        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .users-table th, .users-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .users-table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        .users-table tr:hover {
            background-color: #f5f5f5;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 5px;
            width: 80%;
            max-width: 500px;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .close {
            cursor: pointer;
            font-size: 1.5em;
        }
        .members-container {
            margin-top: 20px;
        }
        .member-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .member-avatar {
            width: 50px;
            height: 50px;
            background: #007bff;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            margin-right: 15px;
        }
        .member-info h3 {
            margin: 0;
            color: #333;
            font-size: 18px;
        }
        .member-info p {
            margin: 5px 0;
            color: #666;
            font-size: 14px;
        }
        .member-details {
            border-top: 1px solid #eee;
            padding-top: 15px;
            margin-bottom: 15px;
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .detail-label {
            color: #666;
            font-size: 14px;
        }
        .detail-value {
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }
        .member-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        .no-data {
            text-align: center;
            color: #666;
            padding: 20px;
            font-style: italic;
        }
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        .event-upload textarea {
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        /* Exam Management Styles */
        .exam-subjects {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .subject-exam-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .subject-exam-card h3 {
            color: #1a237e;
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .exam-list {
            margin-bottom: 15px;
        }
        
        .exam-item {
            background: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .exam-item .form-group {
            margin-bottom: 10px;
        }
        
        .exam-item .btn {
            margin-top: 5px;
        }
        
        .exam-structure {
            margin-top: 20px;
        }
        
        .subject-exam-structure {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .subject-exam-structure h4 {
            color: #1a237e;
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .exam-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .exam-table th, .exam-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .exam-table th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        
        .exam-table tr:hover {
            background-color: #f9f9f9;
        }

        .student-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .marks-grid {
            display: grid;
            gap: 20px;
        }

        .semester-section {
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .subject-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
        }

        .exams-list {
            margin-top: 10px;
        }

        .exam-input {
            margin: 10px 0;
        }

        .exam-input label {
            display: block;
            margin-bottom: 5px;
            color: #666;
        }

        .exam-input input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .students-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .student-marks-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .student-header {
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        
        .student-header h3 {
            margin: 0;
            color: #1a237e;
        }
        
        .student-header p {
            margin: 5px 0;
            color: #666;
        }
        
        .marks-input-section {
            margin-bottom: 20px;
        }
        
        .marks-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
        }
        
        .marks-list {
            margin-top: 10px;
        }
        
        .mark-item {
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .mark-item strong {
            display: block;
            margin-bottom: 5px;
            color: #1a237e;
        }

        .students-list {
            margin-top: 20px;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        .marks-entry {
            margin-top: 20px;
        }
        .student-header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .student-header h3 {
            margin: 0 0 10px 0;
        }
        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        .subject-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .subject-card h4 {
            margin: 0 0 15px 0;
            color: #333;
        }
        .exams-list {
            display: grid;
            gap: 10px;
        }
        .exam-input {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            align-items: center;
        }
        .exam-input input {
            width: 80px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .exam-input label {
            color: #666;
        }
        .calendar-display-container {
            margin-top: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .calendar-display-container h3 {
            color: #1a237e;
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .calendar-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .calendar-sidebar {
            flex: 1;
            min-width: 250px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .calendar-main {
            flex: 3;
            min-width: 300px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .month-view {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 20px;
        }
        
        .calendar-day {
            border: 1px solid #ddd;
            padding: 10px;
            min-height: 80px;
            position: relative;
            background: white;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .calendar-day:hover {
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .calendar-day.today {
            background-color: #e3f2fd;
            border: 1px solid #1a237e;
        }
        
        .calendar-day.has-event {
            background-color: #f5f5f5;
        }
        
        .day-number {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        
        .day-event {
            font-size: 12px;
            padding: 2px 4px;
            margin-bottom: 2px;
            border-radius: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .day-event:hover {
            transform: scale(1.05);
        }
        
        .day-event.exam {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .day-event.assignment {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        
        .day-event.holiday {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .day-event.other {
            background-color: #f3e5f5;
            color: #6a1b9a;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-nav {
            display: flex;
            gap: 10px;
        }
        
        .weekday-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 5px;
        }
        
        .weekday {
            text-align: center;
            font-weight: bold;
            padding: 5px;
            color: #1a237e;
        }
        
        .event-list {
            margin-top: 20px;
        }
        
        .event-list-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            transition: all 0.2s ease;
        }
        
        .event-list-item:hover {
            background-color: #f5f5f5;
        }
        
        .event-list-item:last-child {
            border-bottom: none;
        }
        
        .event-list-date {
            font-weight: bold;
            color: #1a237e;
        }
        
        .event-list-title {
            margin: 5px 0;
        }
        
        .event-list-type {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
            margin-right: 5px;
        }
        
        .event-list-description {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        .no-events {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }

        /* Calendar specific styles */
        .calendar-controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .add-event-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .calendar-view {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .calendar-grid {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
        }

        .weekday-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .weekday-header div {
            padding: 10px;
            text-align: center;
            font-weight: bold;
            color: #495057;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .calendar-day {
            border: 1px solid #dee2e6;
            min-height: 100px;
            padding: 10px;
            background: white;
        }

        .calendar-day.today {
            background: #e3f2fd;
        }

        .calendar-day .date {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .event-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin: 2px;
            display: inline-block;
        }

        .event-dot.exam { background: #dc3545; }
        .event-dot.assignment { background: #007bff; }
        .event-dot.holiday { background: #28a745; }
        .event-dot.other { background: #6c757d; }

        .events-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .event-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .event-card h4 {
            margin: 0 0 10px 0;
            color: #1a237e;
        }

        .event-type-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .event-type-badge.exam { background: #ffebee; color: #c62828; }
        .event-type-badge.assignment { background: #e3f2fd; color: #1565c0; }
        .event-type-badge.holiday { background: #e8f5e9; color: #2e7d32; }
        .event-type-badge.other { background: #f3e5f5; color: #6a1b9a; }

        .event-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <header class="top-header">
        <div class="logo-section">
            <h1>Nexora</h1>
        </div>
    </header>
    
    <nav class="nav-bar">
        <div class="nav-container">
            <ul class="nav-links">
                <li><a href="#members" class="active" onclick="showSection('members')">Members</a></li>
                <li><a href="#courses" onclick="showSection('courses')">Course Management</a></li>
                <li><a href="#exams" onclick="showSection('exams')">Exam Management</a></li>
                <li><a href="#studentMarks" onclick="showSection('studentMarks')">Student Marks</a></li>
                <li><a href="#academicCalendar" onclick="showSection('academicCalendar')">Academic Calendar</a></li>
            </ul>
            <button onclick="signOut()" class="btn btn-danger">Sign Out</button>
        </div>
    </nav>

    <div class="container">
        <section id="members" class="content-section">
            <h2 class="section-header">Members</h2>
            <div class="filters">
                <div class="form-group">
                    <label for="branchFilter">Branch:</label>
                    <select id="branchFilter" onchange="loadMembers()">
                        <option value="">All Branches</option>
                        <option value="CSE">Computer Science Engineering</option>
                        <option value="MECH">Mechanical Engineering</option>
                        <option value="EEE">Electrical Engineering</option>
                        <option value="CIVIL">Civil Engineering</option>
                        <option value="CHEM">Chemical Engineering</option>
                    </select>
                </div>
                </div>
            <div id="membersList" class="members-grid">
                <!-- Members will be displayed here -->
            </div>
        </section>

        <section id="courses" class="content-section" style="display: none;">
            <h2 class="section-header">Course Management</h2>
            <div class="form-group">
                <label for="courseBranch">Select Branch</label>
                <select id="courseBranch" onchange="loadCourses()" required>
                    <option value="">Choose a branch</option>
                    <option value="CSE">Computer Science</option>
                    <option value="MECH">Mechanical Engineering</option>
                    <option value="EEE">Electrical Engineering</option>
                    <option value="CIVIL">Civil Engineering</option>
                    <option value="CHEM">Chemical Engineering</option>
                </select>
            </div>
            <div class="form-group">
                <label for="courseSemester">Select Semester</label>
                <select id="courseSemester" onchange="loadCourses()" required>
                    <option value="">Select Semester</option>
                    <option value="1">Semester 1</option>
                    <option value="2">Semester 2</option>
                    <option value="3">Semester 3</option>
                    <option value="4">Semester 4</option>
                    <option value="5">Semester 5</option>
                    <option value="6">Semester 6</option>
                    <option value="7">Semester 7</option>
                    <option value="8">Semester 8</option>
                </select>
            </div>
            <div id="subjectsContainer">
                <!-- Subjects will be added here dynamically -->
            </div>
            <button onclick="addSubject()" class="btn btn-primary">Add Subject</button>
            <button onclick="saveCourses()" class="btn btn-success">Save Course Details</button>
        </section>

        <section id="studentMarks" class="content-section" style="display: none;">
            <h2 class="section-header">Student Marks Management</h2>
            
            <div class="filters">
            <div class="form-group">
                    <label for="marksBranch">Select Branch</label>
                    <select id="marksBranch" onchange="loadStudentsByBranch()">
                        <option value="">Select Branch</option>
                        <option value="CSE">Computer Science Engineering</option>
                        <option value="MECH">Mechanical Engineering</option>
                        <option value="EEE">Electrical Engineering</option>
                        <option value="CIVIL">Civil Engineering</option>
                        <option value="CHEM">Chemical Engineering</option>
                </select>
            </div>
            </div>

            <div id="studentMarksContainer">
                <!-- Students will be displayed here -->
            </div>
        </section>

        <section id="exams" class="content-section" style="display: none;">
            <h2 class="section-header">Exam Management</h2>
            <div class="form-group">
                <label for="examBranch">Select Branch</label>
                <select id="examBranch" onchange="loadExamSubjects()" required>
                    <option value="">Choose a branch</option>
                    <option value="CSE">Computer Science</option>
                    <option value="MECH">Mechanical Engineering</option>
                    <option value="EEE">Electrical Engineering</option>
                    <option value="CIVIL">Civil Engineering</option>
                    <option value="CHEM">Chemical Engineering</option>
                </select>
            </div>
            <div class="form-group">
                <label for="examSemester">Select Semester</label>
                <select id="examSemester" onchange="loadExamSubjects()" required>
                    <option value="">Select Semester</option>
                    <option value="1">Semester 1</option>
                    <option value="2">Semester 2</option>
                    <option value="3">Semester 3</option>
                    <option value="4">Semester 4</option>
                    <option value="5">Semester 5</option>
                    <option value="6">Semester 6</option>
                    <option value="7">Semester 7</option>
                    <option value="8">Semester 8</option>
                </select>
            </div>
            <div id="examSubjectsContainer">
                <!-- Exam subjects will be displayed here -->
            </div>
            <div class="button-group">
                <button onclick="saveExamDetails()" class="btn btn-primary">Save Exam Details</button>
            </div>
        </section>

        <section id="academicCalendar" class="content-section" style="display: none;">
            <h2 class="section-header">Academic Calendar</h2>
            
            <div class="calendar-controls">
                <div class="form-row">
            <div class="form-group">
                        <label for="calendarBranch">Select Branch</label>
                        <select id="calendarBranch" onchange="loadCalendarEvents()" required>
                            <option value="">All Branches</option>
                            <option value="CSE">Computer Science Engineering</option>
                            <option value="MECH">Mechanical Engineering</option>
                            <option value="EEE">Electrical Engineering</option>
                            <option value="CIVIL">Civil Engineering</option>
                            <option value="CHEM">Chemical Engineering</option>
                </select>
            </div>
            <div class="form-group">
                        <label for="calendarSemester">Select Semester</label>
                        <select id="calendarSemester" onchange="loadCalendarEvents()" required>
                            <option value="">All Semesters</option>
                            <option value="1">Semester 1</option>
                            <option value="2">Semester 2</option>
                            <option value="3">Semester 3</option>
                            <option value="4">Semester 4</option>
                            <option value="5">Semester 5</option>
                            <option value="6">Semester 6</option>
                            <option value="7">Semester 7</option>
                            <option value="8">Semester 8</option>
                        </select>
            </div>
                </div>
                
                <div class="add-event-card">
                    <h3>Add New Event</h3>
                    <div class="form-group">
                        <label for="eventTitle">Event Title</label>
                        <input type="text" id="eventTitle" placeholder="Enter event title" required>
                    </div>
                    <div class="form-group">
                        <label for="eventDate">Event Date</label>
                        <input type="date" id="eventDate" required>
                    </div>
                    <div class="form-group">
                        <label for="eventDescription">Event Description</label>
                        <textarea id="eventDescription" rows="3" placeholder="Enter event description"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="eventType">Event Type</label>
                        <select id="eventType" required>
                            <option value="exam">Exam</option>
                            <option value="assignment">Assignment</option>
                            <option value="holiday">Holiday</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <button onclick="addCalendarEvent()" class="btn btn-primary">Add Event</button>
                </div>
            </div>

            <div class="calendar-view">
                <div class="calendar-header">
                    <h3>Calendar View</h3>
                    <div class="calendar-nav">
                        <button onclick="adminPreviousMonth()" class="btn btn-secondary">&lt; Previous</button>
                        <h4 id="adminCurrentMonthDisplay"></h4>
                        <button onclick="adminNextMonth()" class="btn btn-secondary">Next &gt;</button>
                    </div>
                </div>

                <div class="calendar-grid">
                    <div class="weekday-header">
                        <div>Sun</div>
                        <div>Mon</div>
                        <div>Tue</div>
                        <div>Wed</div>
                        <div>Thu</div>
                        <div>Fri</div>
                        <div>Sat</div>
                    </div>
                    <div id="adminCalendarDays" class="calendar-days"></div>
                </div>
            </div>

            <div class="events-section">
                <h3>Current Events</h3>
                <div id="calendarEventsList" class="events-grid">
                    <!-- Events will be displayed here -->
                </div>
            </div>
        </section>
    </div>

    <!-- Edit User Modal -->
    <div id="editUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit User</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <form id="editUserForm">
                <div class="form-group">
                    <label for="editName">Name</label>
                    <input type="text" id="editName" required>
                </div>
                <div class="form-group">
                    <label for="editEmail">Email</label>
                    <input type="email" id="editEmail" required>
                </div>
                <div class="form-group">
                    <label for="editGroupCode">Group Code</label>
                    <input type="text" id="editGroupCode" readonly>
                </div>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
        </div>
    </div>

    <script>
        let currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        let selectedUserId = null;

        if (!currentUser.isAdmin) {
            window.location.href = 'auth.html';
        }

        function loadUsers() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const tbody = document.querySelector('#userTable tbody');
            tbody.innerHTML = '';

            users.forEach(user => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.groupCode || 'Not Set'}</td>
                    <td>
                        <button onclick="showEditUserModal('${user.id}')" class="btn btn-primary">Edit</button>
                        <button onclick="deleteUser('${user.id}')" class="btn btn-danger">Delete</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function showEditUserModal(userId) {
            selectedUserId = userId;
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.id === userId);

            document.getElementById('editName').value = user.name;
            document.getElementById('editEmail').value = user.email;
            document.getElementById('editGroupCode').value = user.groupCode;
            document.getElementById('editUserModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('editUserModal').style.display = 'none';
        }

        function saveUserChanges(event) {
            event.preventDefault();
            
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === selectedUserId);

            if (userIndex !== -1) {
                users[userIndex].name = document.getElementById('editName').value;
                users[userIndex].email = document.getElementById('editEmail').value;
                localStorage.setItem('users', JSON.stringify(users));
                closeModal();
                loadUsers();
            }
        }

        function loadExamSubjects() {
            const branchCode = document.getElementById('examBranch').value;
            const semester = document.getElementById('examSemester').value;
            const examSubjectsContainer = document.getElementById('examSubjectsContainer');
            
            // Clear container when changing semester or branch
            examSubjectsContainer.innerHTML = '';
            
            if (!branchCode || !semester) {
                examSubjectsContainer.innerHTML = '<p>Please select branch and semester</p>';
                return;
            }
            
            // Get course data to find subjects
            const courseData = JSON.parse(localStorage.getItem('courseData') || '{}');
            if (!courseData[branchCode] || !courseData[branchCode][semester]) {
                examSubjectsContainer.innerHTML = '<p>No subjects found for this branch and semester. Please add subjects in Course Management first.</p>';
                return;
            }
            
            const subjects = courseData[branchCode][semester];
            const examData = JSON.parse(localStorage.getItem('examData') || '{}');
            
            let examHtml = '<div class="exam-subjects">';
            subjects.forEach(subject => {
                const subjectExams = examData[branchCode]?.[semester]?.[subject.name] || [];
                
                examHtml += `
                    <div class="subject-exam-card">
                        <h3>${subject.name} (${subject.credits} credits)</h3>
                        <div class="exam-list" id="exam-list-${subject.name.replace(/\s+/g, '-')}">
                            ${subjectExams.map((exam, index) => `
                                <div class="exam-item">
                                    <div class="form-group">
                                        <label>Exam Name</label>
                                        <input type="text" class="exam-name" value="${exam.name}" placeholder="e.g., Mid-term">
                                    </div>
                                    <div class="form-group">
                                        <label>Weightage (%)</label>
                                        <input type="number" class="exam-weightage" value="${exam.weightage}" min="0" max="100">
                                    </div>
                                    <button onclick="removeExam('${subject.name.replace(/\s+/g, '-')}', ${index})" class="btn btn-danger">Remove</button>
                                </div>
                            `).join('')}
                        </div>
                        <button onclick="addExam('${subject.name.replace(/\s+/g, '-')}')" class="btn btn-primary">Add Exam</button>
                    </div>
                `;
            });
            examHtml += '</div>';
            examSubjectsContainer.innerHTML = examHtml;
        }
        
        function addExam(subjectId) {
            const examList = document.getElementById(`exam-list-${subjectId}`);
            const examItem = document.createElement('div');
            examItem.className = 'exam-item';
            examItem.innerHTML = `
                <div class="form-group">
                    <label>Exam Name</label>
                    <input type="text" class="exam-name" placeholder="e.g., Mid-term">
                    </div>
                <div class="form-group">
                    <label>Weightage (%)</label>
                    <input type="number" class="exam-weightage" min="0" max="100">
                    </div>
                <button onclick="this.parentElement.remove()" class="btn btn-danger">Remove</button>
            `;
            examList.appendChild(examItem);
        }
        
        function removeExam(subjectId, index) {
            const examList = document.getElementById(`exam-list-${subjectId}`);
            const examItems = examList.getElementsByClassName('exam-item');
            if (index >= 0 && index < examItems.length) {
                examItems[index].remove();
            }
        }
        
        function saveExamDetails() {
            const branchCode = document.getElementById('examBranch').value;
            const semester = document.getElementById('examSemester').value;
            
            if (!branchCode || !semester) {
                alert('Please select branch and semester');
                return;
            }
            
            const courseData = JSON.parse(localStorage.getItem('courseData') || '{}');
            if (!courseData[branchCode] || !courseData[branchCode][semester]) {
                alert('No subjects found for this branch and semester');
                return;
            }
            
            const subjects = courseData[branchCode][semester];
            const examData = JSON.parse(localStorage.getItem('examData') || '{}');
            
            if (!examData[branchCode]) {
                examData[branchCode] = {};
            }
            if (!examData[branchCode][semester]) {
                examData[branchCode][semester] = {};
            }
            
            let hasError = false;
            
            subjects.forEach(subject => {
                const subjectId = subject.name.replace(/\s+/g, '-');
                const examList = document.getElementById(`exam-list-${subjectId}`);
                const examItems = examList.getElementsByClassName('exam-item');
                
                const subjectExams = [];
                let subjectTotalWeightage = 0;
                
                for (let i = 0; i < examItems.length; i++) {
                    const examName = examItems[i].querySelector('.exam-name').value;
                    const weightage = parseInt(examItems[i].querySelector('.exam-weightage').value);
                    
                    if (!examName) {
                        alert(`Please enter exam name for ${subject.name}`);
                        hasError = true;
                        break;
                    }
                    
                    if (isNaN(weightage) || weightage <= 0) {
                        alert(`Please enter valid weightage for ${examName} in ${subject.name}`);
                        hasError = true;
                        break;
                    }
                    
                    subjectTotalWeightage += weightage;
                    subjectExams.push({ name: examName, weightage });
                }
                
                if (hasError) return;
                
                if (subjectTotalWeightage !== 100) {
                    alert(`Total weightage for ${subject.name} must be 100%. Current total: ${subjectTotalWeightage}%`);
                    hasError = true;
                    return;
                }
                
                examData[branchCode][semester][subject.name] = subjectExams;
            });
            
            if (hasError) return;
            
            localStorage.setItem('examData', JSON.stringify(examData));
            alert('Exam details saved successfully');
            
            // Refresh the display
            loadExamSubjects();
        }

        function loadMembers() {
            const branchFilter = document.getElementById('branchFilter').value;
            const users = JSON.parse(localStorage.getItem('users')) || [];
            console.log('Total users:', users.length);
            
            const filteredUsers = users.filter(user => {
                if (user.isAdmin) return false;
                return !branchFilter || user.branchCode === branchFilter;
            });
            
            console.log('Filtered users:', filteredUsers.length);
            
            const membersList = document.getElementById('membersList');
            if (filteredUsers.length === 0) {
                membersList.innerHTML = '<p>No members found.</p>';
                return;
            }
            
            membersList.innerHTML = filteredUsers.map(user => `
                <div class="member-card">
                    <div class="member-info">
                        <h3>${user.name}</h3>
                        <p>Email: ${user.email}</p>
                        <p>Branch: ${user.branchCode || 'Not specified'}</p>
                        <p>Academic Year: ${user.enrollment?.academicYear || 'Not specified'}</p>
                    </div>
                    <div class="member-actions">
                        <button onclick="editMember('${user.id}')" class="btn btn-warning">Edit</button>
                        <button onclick="deleteMember('${user.id}')" class="btn btn-danger">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function editMember(userId) {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.id === userId);
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>Edit Member</h2>
                    <form id="editMemberForm">
                        <div class="form-group">
                            <label for="editName">Name</label>
                            <input type="text" id="editName" value="${user.name}" required>
                        </div>
                        <div class="form-group">
                            <label for="editEmail">Email</label>
                            <input type="email" id="editEmail" value="${user.email}" required>
                        </div>
                        <div class="form-group">
                            <label for="editBranch">Branch</label>
                            <select id="editBranch" required>
                                <option value="CSE" ${user.branchCode === 'CSE' ? 'selected' : ''}>Computer Science Engineering</option>
                                <option value="MECH" ${user.branchCode === 'MECH' ? 'selected' : ''}>Mechanical Engineering</option>
                                <option value="EEE" ${user.branchCode === 'EEE' ? 'selected' : ''}>Electrical Engineering</option>
                                <option value="CIVIL" ${user.branchCode === 'CIVIL' ? 'selected' : ''}>Civil Engineering</option>
                                <option value="CHEM" ${user.branchCode === 'CHEM' ? 'selected' : ''}>Chemical Engineering</option>
                            </select>
                        </div>
                        <div class="button-group">
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                            <button type="button" class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('editMemberForm').onsubmit = function(e) {
                e.preventDefault();
                
                const updatedUser = {
                    ...user,
                    name: document.getElementById('editName').value,
                    email: document.getElementById('editEmail').value,
                    branchCode: document.getElementById('editBranch').value
                };
                
                const userIndex = users.findIndex(u => u.id === userId);
                users[userIndex] = updatedUser;
                
                localStorage.setItem('users', JSON.stringify(users));
                modal.remove();
                loadMembers();
                
                alert('Member updated successfully');
            };
        }

        function deleteMember(userId) {
            if (!confirm('Are you sure you want to delete this member? This action cannot be undone.')) {
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const updatedUsers = users.filter(user => user.id !== userId);
            
            localStorage.setItem('users', JSON.stringify(updatedUsers));
            loadMembers();
            
            alert('Member deleted successfully');
            }
            
        function signOut() {
            localStorage.removeItem('currentUser');
            window.location.href = 'auth.html';
        }

        document.getElementById('editUserForm').onsubmit = saveUserChanges;
        window.onclick = (event) => {
            if (event.target === document.getElementById('editUserModal')) {
                closeModal();
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            // Check admin status
            if (!currentUser.isAdmin) {
                window.location.href = 'auth.html';
                return;
            }

            // Initialize the members section
            showSection('members');
            loadMembers();

            // Add event listeners for filters
            document.getElementById('branchFilter').addEventListener('change', loadMembers);

            // Initialize other sections
            document.getElementById('groupCode').addEventListener('change', loadExamSubjects);
            document.getElementById('examSemester').addEventListener('change', loadExamSubjects);
            document.getElementById('calendarBranch').addEventListener('change', loadCalendarEvents);
            document.getElementById('calendarSemester').addEventListener('change', loadCalendarEvents);
        });

        function handleSemesterChange() {
            clearSubjectsContainer();
            loadSavedSubjects();
        }

        function clearSubjectsContainer() {
            const subjectsContainer = document.getElementById('subjectsContainer');
            subjectsContainer.innerHTML = '';
        }

        function loadSavedSubjects() {
            const branchCode = document.getElementById('courseBranch').value;
            const semester = document.getElementById('courseSemester').value;
            
            if (!branchCode || !semester) return;
            
            const courseData = JSON.parse(localStorage.getItem('courseData') || '{}');
            const savedSubjects = courseData[branchCode]?.[semester] || [];
            
            savedSubjects.forEach(subject => {
                const subjectDiv = document.createElement('div');
                subjectDiv.className = 'subject-entry';
                subjectDiv.innerHTML = `
                    <div class="form-group">
                        <input type="text" placeholder="Subject Name" class="subject-name" value="${subject.name}" required>
                        <input type="number" placeholder="Credits" class="subject-credits" min="1" max="5" value="${subject.credits}" required>
                        <button onclick="this.parentElement.parentElement.remove()" class="btn btn-danger">Remove</button>
                    </div>
                `;
                document.getElementById('subjectsContainer').appendChild(subjectDiv);
            });
        }

        function addSubject() {
            const subjectsContainer = document.getElementById('subjectsContainer');
            const subjectDiv = document.createElement('div');
            subjectDiv.className = 'subject-entry';
            subjectDiv.style.marginBottom = '15px';
            subjectDiv.style.padding = '10px';
            subjectDiv.style.border = '1px solid #ddd';
            subjectDiv.style.borderRadius = '4px';
            subjectDiv.innerHTML = `
                <div class="form-group">
                    <input type="text" placeholder="Subject Name" class="subject-name" required>
                    <input type="number" placeholder="Credits" class="subject-credits" min="1" max="5" required>
                    <button onclick="this.parentElement.parentElement.remove()" class="btn btn-danger">Remove</button>
                </div>
            `;
            subjectsContainer.appendChild(subjectDiv);
        }

        function loadCourses() {
            const branchCode = document.getElementById('courseBranch').value;
            const semester = document.getElementById('courseSemester').value;
            const subjectsContainer = document.getElementById('subjectsContainer');
            
            // Clear container when changing semester or branch
            subjectsContainer.innerHTML = '';
            
            if (!branchCode || !semester) {
                subjectsContainer.innerHTML = '<p>Please select branch and semester</p>';
                return;
            }

            const courseData = JSON.parse(localStorage.getItem('courseData') || '{}');
            const subjects = courseData[branchCode]?.[semester] || [];

            if (subjects.length === 0) {
                subjectsContainer.innerHTML = '<p>No subjects found for this branch and semester</p>';
                return;
            }

            subjects.forEach(subject => {
                const subjectDiv = document.createElement('div');
                subjectDiv.className = 'subject-entry';
                subjectDiv.style.marginBottom = '15px';
                subjectDiv.style.padding = '10px';
                subjectDiv.style.border = '1px solid #ddd';
                subjectDiv.style.borderRadius = '4px';
                subjectDiv.innerHTML = `
                    <div class="form-group">
                        <input type="text" placeholder="Subject Name" class="subject-name" value="${subject.name}" required>
                        <input type="number" placeholder="Credits" class="subject-credits" min="1" max="5" value="${subject.credits}" required>
                        <button onclick="this.parentElement.parentElement.remove()" class="btn btn-danger">Remove</button>
                    </div>
                `;
                subjectsContainer.appendChild(subjectDiv);
            });
        }
        
        function removeCourse(index) {
            const branchCode = document.getElementById('courseBranch').value;
            const semester = document.getElementById('courseSemester').value;
            
            if (!branchCode || !semester) {
                alert('Please select branch and semester');
                return;
            }

            const courseData = JSON.parse(localStorage.getItem('courseData') || '{}');
            if (!courseData[branchCode] || !courseData[branchCode][semester]) {
                return;
            }

            const subjects = courseData[branchCode][semester];
            if (index >= 0 && index < subjects.length) {
                subjects.splice(index, 1);
                courseData[branchCode][semester] = subjects;
                localStorage.setItem('courseData', JSON.stringify(courseData));
                loadCourses();
            }
        }
        
        function saveCourses() {
            const branchCode = document.getElementById('courseBranch').value;
            const semester = document.getElementById('courseSemester').value;
            
            if (!branchCode || !semester) {
                alert('Please select branch and semester');
                return;
            }

            const courseData = JSON.parse(localStorage.getItem('courseData') || '{}');
            if (!courseData[branchCode]) {
                courseData[branchCode] = {};
            }
            
            // Get all subject entries from the container
            const subjectsContainer = document.getElementById('subjectsContainer');
            const subjectEntries = subjectsContainer.getElementsByClassName('subject-entry');
            
            const subjects = [];
            let hasError = false;
            
            // Process each subject entry
            for (let i = 0; i < subjectEntries.length; i++) {
                const nameInput = subjectEntries[i].querySelector('.subject-name');
                const creditsInput = subjectEntries[i].querySelector('.subject-credits');
                
                if (!nameInput || !creditsInput) continue;
                
                const name = nameInput.value.trim();
                const credits = parseFloat(creditsInput.value);
                
                if (!name) {
                    alert('Please enter subject name');
                    hasError = true;
                    break;
                }
                
                if (isNaN(credits) || credits <= 0) {
                    alert(`Please enter valid credits for ${name}`);
                    hasError = true;
                    break;
                }
                
                subjects.push({ name, credits });
            }
            
            if (hasError) return;
            
            // Save the subjects for this branch and semester
            courseData[branchCode][semester] = subjects;
            localStorage.setItem('courseData', JSON.stringify(courseData));

            // Show success message
            const successMsg = document.createElement('div');
            successMsg.className = 'success-message';
            successMsg.textContent = 'Courses saved successfully';
            successMsg.style.color = 'green';
            successMsg.style.marginTop = '10px';
            successMsg.style.padding = '5px';
            successMsg.style.backgroundColor = '#e8f5e9';
            successMsg.style.borderRadius = '4px';
            
            subjectsContainer.insertBefore(successMsg, subjectsContainer.firstChild);
            
            // Remove the message after 3 seconds
            setTimeout(() => {
                successMsg.remove();
            }, 3000);
            
            // Refresh the display
            loadCourses();
        }

        function loadStudentsByBranch() {
            const branchCode = document.getElementById('marksBranch').value;
            const container = document.getElementById('studentMarksContainer');
            
            if (!branchCode) {
                container.innerHTML = '<p>Please select a branch</p>';
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            console.log('Total users:', users.length);
            console.log('Selected branch:', branchCode);

            // Filter students by branch
            const students = users.filter(user => {
                console.log('User:', user.name, 'Branch:', user.branchCode, 'Admin:', user.isAdmin);
                return !user.isAdmin && user.branchCode === branchCode;
            });

            console.log('Filtered students:', students.length);

            if (students.length === 0) {
                container.innerHTML = '<p>No students found in this branch</p>';
                return;
            }
            
            let html = `
                <div class="students-list">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Semester</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            students.forEach(student => {
                const semester = localStorage.getItem(`semester_${student.id}`) || 'Not Set';
                html += `
                    <tr>
                        <td>${student.name}</td>
                        <td>${student.email}</td>
                        <td>${semester}</td>
                        <td>
                            <button class="btn btn-primary" onclick="showMarksEntry('${student.id}')">
                                Enter Marks
                            </button>
                        </td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                    </div>
                `;
            
            container.innerHTML = html;
        }
        
        function showMarksEntry(studentId) {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const student = users.find(u => u.id === studentId);
            
            // Create semester selection modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>Select Semester for ${student.name}</h2>
                        <div class="form-group">
                        <label for="semesterSelect">Select Semester</label>
                        <select id="semesterSelect" class="form-control">
                            <option value="">Select Semester</option>
                            <option value="1">Semester 1</option>
                            <option value="2">Semester 2</option>
                            <option value="3">Semester 3</option>
                            <option value="4">Semester 4</option>
                            <option value="5">Semester 5</option>
                            <option value="6">Semester 6</option>
                            <option value="7">Semester 7</option>
                            <option value="8">Semester 8</option>
                            </select>
                        </div>
                        <div class="button-group">
                        <button onclick="loadMarksForSemester('${studentId}')" class="btn btn-primary">View Marks</button>
                        <button onclick="this.closest('.modal').remove()" class="btn btn-secondary">Cancel</button>
                        </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function loadMarksForSemester(studentId) {
            const semester = document.getElementById('semesterSelect').value;
            if (!semester) {
                alert('Please select a semester');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const student = users.find(u => u.id === studentId);

            const courseData = JSON.parse(localStorage.getItem('courseData') || '{}');
            const examData = JSON.parse(localStorage.getItem('examData') || '{}');
            const studentMarks = JSON.parse(localStorage.getItem('studentMarks') || '{}');
            
            const branchCourses = courseData[student.branchCode]?.[semester] || [];
            const branchExams = examData[student.branchCode]?.[semester] || {};
            const studentSubjectMarks = studentMarks[studentId]?.[semester] || {};

            if (branchCourses.length === 0) {
                alert('No courses found for this semester. Please add courses first.');
                return;
            }

            let html = `
                <div class="marks-entry">
                    <div class="student-header">
                        <h3>Marks for ${student.name}</h3>
                        <p>Branch: ${student.branchCode}</p>
                        <p>Semester: ${semester}</p>
                        <button class="btn btn-secondary" onclick="loadStudentsByBranch()">Back to Students List</button>
                    </div>
                    <div class="subjects-grid">
            `;

            branchCourses.forEach(subject => {
                const subjectExams = branchExams[subject.name] || [];
                const subjectMarks = studentSubjectMarks[subject.name] || {};

                html += `
                    <div class="subject-card">
                        <h4>${subject.name} (${subject.credits} credits)</h4>
                        <div class="exams-list">
                `;

                if (subjectExams.length === 0) {
                    html += `<p class="text-warning">No exams defined for this subject. Please add exams in Exam Management.</p>`;
                } else {
                    subjectExams.forEach(exam => {
                        const currentMark = subjectMarks[exam.name] || '';
                        html += `
                            <div class="exam-input">
                                <label>${exam.name} (Max: ${exam.weightage})</label>
                                <input 
                                    type="number" 
                                    value="${currentMark}"
                                min="0" 
                                    max="${exam.weightage}"
                                    onchange="saveStudentMark('${studentId}', '${semester}', '${subject.name}', '${exam.name}', this.value, ${exam.weightage})"
                                >
                        </div>
                    `;
                });
            }

                html += `
                        </div>
                    </div>
                `;
            });

            html += `
                    </div>
                </div>
            `;

            // Remove the semester selection modal
            document.querySelector('.modal').remove();
            
            // Display the marks entry interface
            document.getElementById('studentMarksContainer').innerHTML = html;
        }

        function saveStudentMark(studentId, semester, subject, examName, marks, maxMarks) {
            marks = parseInt(marks);
            if (isNaN(marks) || marks < 0 || marks > maxMarks) {
                alert(`Please enter a valid mark between 0 and ${maxMarks}`);
                return;
            }
            
            let studentMarks = JSON.parse(localStorage.getItem('studentMarks') || '{}');
            if (!studentMarks[studentId]) {
                studentMarks[studentId] = {};
            }
            if (!studentMarks[studentId][semester]) {
                studentMarks[studentId][semester] = {};
            }
            if (!studentMarks[studentId][semester][subject]) {
                studentMarks[studentId][semester][subject] = {};
            }

            studentMarks[studentId][semester][subject][examName] = marks;
            localStorage.setItem('studentMarks', JSON.stringify(studentMarks));

            // Show success message
            const successMsg = document.createElement('div');
            successMsg.className = 'alert alert-success';
            successMsg.style.position = 'fixed';
            successMsg.style.top = '20px';
            successMsg.style.right = '20px';
            successMsg.style.padding = '10px';
            successMsg.style.backgroundColor = '#d4edda';
            successMsg.style.border = '1px solid #c3e6cb';
            successMsg.style.borderRadius = '4px';
            successMsg.style.color = '#155724';
            successMsg.style.zIndex = '1000';
            successMsg.textContent = 'Marks saved successfully!';
            document.body.appendChild(successMsg);

            setTimeout(() => {
                successMsg.remove();
            }, 2000);
        }

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            // Show selected section
            document.getElementById(sectionId).style.display = 'block';
            // Update active nav link
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + sectionId) {
                    link.classList.add('active');
                }
            });
        }

        let adminCurrentDate = new Date();
        let adminCurrentMonth = adminCurrentDate.getMonth();
        let adminCurrentYear = adminCurrentDate.getFullYear();
        
        function loadCalendarEvents() {
            const branchCode = document.getElementById('calendarBranch').value;
            const semester = document.getElementById('calendarSemester').value;
            const eventsList = document.getElementById('calendarEventsList');
            
            // Get calendar events from localStorage
            const calendarEvents = JSON.parse(localStorage.getItem('calendarEvents') || '[]');
            
            // Filter events based on selected branch and semester
            let filteredEvents = calendarEvents;
            if (branchCode) {
                filteredEvents = filteredEvents.filter(event => !event.branchCode || event.branchCode === branchCode);
            }
            if (semester) {
                filteredEvents = filteredEvents.filter(event => !event.semester || event.semester === semester);
            }
            
            // Sort events by date
            filteredEvents.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Update calendar view
            renderAdminCalendar(filteredEvents);
            
            // Display events list
            if (filteredEvents.length === 0) {
                eventsList.innerHTML = '<div class="no-events">No events found for the selected criteria</div>';
                return;
            }
            
            let eventsHtml = '';
            filteredEvents.forEach(event => {
                eventsHtml += `
                    <div class="event-card">
                        <h4>${event.title}</h4>
                        <span class="event-type-badge ${event.type}">${event.type}</span>
                        <div class="event-date">${formatDate(event.date)}</div>
                        <div class="event-details">
                            ${event.description ? `<p>${event.description}</p>` : ''}
                            <div class="event-meta">
                                ${event.branchCode ? `<span>Branch: ${event.branchCode}</span>` : ''}
                                ${event.semester ? `<span>Semester: ${event.semester}</span>` : ''}
                            </div>
                        </div>
                        <div class="event-actions">
                            <button onclick="editCalendarEvent('${event.id}')" class="btn btn-secondary">Edit</button>
                            <button onclick="deleteCalendarEvent('${event.id}')" class="btn btn-danger">Delete</button>
                        </div>
                    </div>
                `;
            });
            
            eventsList.innerHTML = eventsHtml;
        }
        
        function renderAdminCalendar(events) {
            const calendarDays = document.getElementById('adminCalendarDays');
            const monthDisplay = document.getElementById('adminCurrentMonthDisplay');
            
            // Update month display
            monthDisplay.textContent = new Date(adminCurrentYear, adminCurrentMonth)
                .toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            
            // Clear previous calendar
            calendarDays.innerHTML = '';
            
            // Get the first day of the month
            const firstDay = new Date(adminCurrentYear, adminCurrentMonth, 1);
            const startingDay = firstDay.getDay();
            
            // Get the number of days in the month
            const daysInMonth = new Date(adminCurrentYear, adminCurrentMonth + 1, 0).getDate();
            
            // Create calendar grid
            for (let i = 0; i < 42; i++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';
                
                const dayNumber = i - startingDay + 1;
                if (dayNumber > 0 && dayNumber <= daysInMonth) {
                    // Add date number
                    const dateDiv = document.createElement('div');
                    dateDiv.className = 'date';
                    dateDiv.textContent = dayNumber;
                    dayCell.appendChild(dateDiv);
                    
                    // Check if this is today
                    const today = new Date();
                    if (dayNumber === today.getDate() && 
                        adminCurrentMonth === today.getMonth() && 
                        adminCurrentYear === today.getFullYear()) {
                        dayCell.classList.add('today');
                    }
                    
                    // Add events for this day
                    const dayEvents = events.filter(event => {
                        const eventDate = new Date(event.date);
                        return eventDate.getDate() === dayNumber && 
                               eventDate.getMonth() === adminCurrentMonth && 
                               eventDate.getFullYear() === adminCurrentYear;
                    });
                    
                    if (dayEvents.length > 0) {
                        const eventsDiv = document.createElement('div');
                        eventsDiv.className = 'day-events';
                        
                        dayEvents.forEach(event => {
                            const eventDot = document.createElement('span');
                            eventDot.className = `event-dot ${event.type}`;
                            eventDot.title = event.title;
                            eventsDiv.appendChild(eventDot);
                        });
                        
                        dayCell.appendChild(eventsDiv);
                    }
                }
                
                calendarDays.appendChild(dayCell);
            }
        }
        
        function formatDate(dateString) {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }

        function adminPreviousMonth() {
            adminCurrentMonth--;
            if (adminCurrentMonth < 0) {
                adminCurrentMonth = 11;
                adminCurrentYear--;
            }
            loadCalendarEvents();
        }

        function adminNextMonth() {
            adminCurrentMonth++;
            if (adminCurrentMonth > 11) {
                adminCurrentMonth = 0;
                adminCurrentYear++;
            }
            loadCalendarEvents();
        }

        function addCalendarEvent() {
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const description = document.getElementById('eventDescription').value;
            const type = document.getElementById('eventType').value;
            const branchCode = document.getElementById('calendarBranch').value;
            const semester = document.getElementById('calendarSemester').value;

            if (!title || !date || !type) {
                alert('Please fill in all required fields');
                return;
            }
            
            const calendarEvents = JSON.parse(localStorage.getItem('calendarEvents') || '[]');
            const newEvent = {
                id: Date.now().toString(),
                title,
                date,
                description,
                type,
                branchCode,
                semester
            };

            calendarEvents.push(newEvent);
            localStorage.setItem('calendarEvents', JSON.stringify(calendarEvents));

            // Clear form
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventDescription').value = '';
            document.getElementById('eventType').value = 'exam';

            // Refresh calendar
            loadCalendarEvents();
        }

        function editCalendarEvent(eventId) {
            const calendarEvents = JSON.parse(localStorage.getItem('calendarEvents') || '[]');
            const event = calendarEvents.find(e => e.id === eventId);
            
            if (!event) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>Edit Event</h2>
                    <form id="editEventForm">
                        <div class="form-group">
                            <label for="editEventTitle">Event Title</label>
                            <input type="text" id="editEventTitle" value="${event.title}" required>
                        </div>
                        <div class="form-group">
                            <label for="editEventDate">Event Date</label>
                            <input type="date" id="editEventDate" value="${event.date}" required>
                        </div>
                        <div class="form-group">
                            <label for="editEventDescription">Event Description</label>
                            <textarea id="editEventDescription" rows="3">${event.description || ''}</textarea>
                        </div>
                        <div class="form-group">
                            <label for="editEventType">Event Type</label>
                            <select id="editEventType" required>
                                <option value="exam" ${event.type === 'exam' ? 'selected' : ''}>Exam</option>
                                <option value="assignment" ${event.type === 'assignment' ? 'selected' : ''}>Assignment</option>
                                <option value="holiday" ${event.type === 'holiday' ? 'selected' : ''}>Holiday</option>
                                <option value="other" ${event.type === 'other' ? 'selected' : ''}>Other</option>
                            </select>
                        </div>
                        <div class="button-group">
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                            <button type="button" class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('editEventForm').onsubmit = function(e) {
                e.preventDefault();
                
                const updatedEvent = {
                    ...event,
                    title: document.getElementById('editEventTitle').value,
                    date: document.getElementById('editEventDate').value,
                    description: document.getElementById('editEventDescription').value,
                    type: document.getElementById('editEventType').value
                };

                const eventIndex = calendarEvents.findIndex(e => e.id === eventId);
                calendarEvents[eventIndex] = updatedEvent;
                
                localStorage.setItem('calendarEvents', JSON.stringify(calendarEvents));
                modal.remove();
                loadCalendarEvents();
                
                alert('Event updated successfully');
            };
        }
        
        function deleteCalendarEvent(eventId) {
            if (!confirm('Are you sure you want to delete this event?')) {
                return;
            }
            
            const calendarEvents = JSON.parse(localStorage.getItem('calendarEvents') || '[]');
            const updatedEvents = calendarEvents.filter(event => event.id !== eventId);
            
            localStorage.setItem('calendarEvents', JSON.stringify(updatedEvents));
            loadCalendarEvents();
            
            alert('Event deleted successfully');
        }
    </script>
</body>
</html> 